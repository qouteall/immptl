<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.48" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://qouteall.fun/immptl/wiki/Implementation-Details.html"><meta property="og:site_name" content="Immersive Portals"><meta property="og:title" content="Implementation Details"><meta property="og:type" content="article"><meta property="og:updated_time" content="2024-03-29T12:11:52.000Z"><meta property="og:locale" content="en-US"><meta property="og:locale:alternate" content="zh-CN"><meta property="article:modified_time" content="2024-03-29T12:11:52.000Z"><link rel="icon" href="/immptl/images/immptl.png"><title>Implementation Details | Immersive Portals</title><meta name="description" content="See through portals and teleport seamlessly.">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/immptl/assets/style.5f4cd812.css">
    <link rel="modulepreload" href="/immptl/assets/app.0c870a62.js"><link rel="modulepreload" href="/immptl/assets/Implementation-Details.html.31612f10.js"><link rel="modulepreload" href="/immptl/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/immptl/assets/Implementation-Details.html.b32b7f59.js"><link rel="prefetch" href="/immptl/assets/Download.html.a86b315a.js"><link rel="prefetch" href="/immptl/assets/index.html.ab0e8abe.js"><link rel="prefetch" href="/immptl/assets/Download.html.32678c76.js"><link rel="prefetch" href="/immptl/assets/index.html.ea88bbc8.js"><link rel="prefetch" href="/immptl/assets/API-for-Other-Mods.html.fa6254b2.js"><link rel="prefetch" href="/immptl/assets/Commands-Reference.html.5ace7ea5.js"><link rel="prefetch" href="/immptl/assets/Config-Options.html.c8f4d025.js"><link rel="prefetch" href="/immptl/assets/Datapack-Based-Custom-Portal-Generation.html.db465aef.js"><link rel="prefetch" href="/immptl/assets/Dimension-Management.html.a4dd5658.js"><link rel="prefetch" href="/immptl/assets/Dimension-Stack.html.222115d2.js"><link rel="prefetch" href="/immptl/assets/MiniScaled.html.73ece166.js"><link rel="prefetch" href="/immptl/assets/Miscellaneous.html.7e536c37.js"><link rel="prefetch" href="/immptl/assets/Old-API.html.c83782db.js"><link rel="prefetch" href="/immptl/assets/Portal-Animation.html.dcd2a382.js"><link rel="prefetch" href="/immptl/assets/Portal-Attributes.html.ca4125e4.js"><link rel="prefetch" href="/immptl/assets/Portal-Customization.html.951552b6.js"><link rel="prefetch" href="/immptl/assets/Portal-Gun.html.b2140c23.js"><link rel="prefetch" href="/immptl/assets/Portals.html.8849c3a4.js"><link rel="prefetch" href="/immptl/assets/index.html.6fedc59d.js"><link rel="prefetch" href="/immptl/assets/Spatial-Transformation.html.02306410.js"><link rel="prefetch" href="/immptl/assets/API-for-Other-Mods.html.ad383eaa.js"><link rel="prefetch" href="/immptl/assets/Commands-Reference.html.7bf2e6a1.js"><link rel="prefetch" href="/immptl/assets/Config-Options.html.f58dada5.js"><link rel="prefetch" href="/immptl/assets/Datapack-Based-Custom-Portal-Generation.html.7cd083dd.js"><link rel="prefetch" href="/immptl/assets/Dimension-Management.html.801d6601.js"><link rel="prefetch" href="/immptl/assets/Dimension-Stack.html.f21880e9.js"><link rel="prefetch" href="/immptl/assets/Implementation-Details.html.45b2819b.js"><link rel="prefetch" href="/immptl/assets/MiniScaled.html.4d966aeb.js"><link rel="prefetch" href="/immptl/assets/Miscellaneous.html.1edbeb5f.js"><link rel="prefetch" href="/immptl/assets/Portal-Attributes.html.144f86e4.js"><link rel="prefetch" href="/immptl/assets/Portal-Customization.html.ec3af4a2.js"><link rel="prefetch" href="/immptl/assets/Portals.html.0a50a0a6.js"><link rel="prefetch" href="/immptl/assets/index.html.b253b4d3.js"><link rel="prefetch" href="/immptl/assets/Spatial-Transformation.html.0fda61d0.js"><link rel="prefetch" href="/immptl/assets/404.html.43d8668c.js"><link rel="prefetch" href="/immptl/assets/Download.html.7469908d.js"><link rel="prefetch" href="/immptl/assets/index.html.8c6e3fdb.js"><link rel="prefetch" href="/immptl/assets/Download.html.9637cfa3.js"><link rel="prefetch" href="/immptl/assets/index.html.45c4820f.js"><link rel="prefetch" href="/immptl/assets/API-for-Other-Mods.html.84d1b3ad.js"><link rel="prefetch" href="/immptl/assets/Commands-Reference.html.98dfed52.js"><link rel="prefetch" href="/immptl/assets/Config-Options.html.d04b8bd0.js"><link rel="prefetch" href="/immptl/assets/Datapack-Based-Custom-Portal-Generation.html.23b6a036.js"><link rel="prefetch" href="/immptl/assets/Dimension-Management.html.993925a5.js"><link rel="prefetch" href="/immptl/assets/Dimension-Stack.html.e0fe23f9.js"><link rel="prefetch" href="/immptl/assets/MiniScaled.html.6fa9edde.js"><link rel="prefetch" href="/immptl/assets/Miscellaneous.html.8b3ff730.js"><link rel="prefetch" href="/immptl/assets/Old-API.html.a4a7dbfc.js"><link rel="prefetch" href="/immptl/assets/Portal-Animation.html.a9f2f8ae.js"><link rel="prefetch" href="/immptl/assets/Portal-Attributes.html.45418be2.js"><link rel="prefetch" href="/immptl/assets/Portal-Customization.html.4b1a0e9d.js"><link rel="prefetch" href="/immptl/assets/Portal-Gun.html.a8763b78.js"><link rel="prefetch" href="/immptl/assets/Portals.html.99f90689.js"><link rel="prefetch" href="/immptl/assets/index.html.dc34f721.js"><link rel="prefetch" href="/immptl/assets/Spatial-Transformation.html.08cf20ed.js"><link rel="prefetch" href="/immptl/assets/API-for-Other-Mods.html.97a35387.js"><link rel="prefetch" href="/immptl/assets/Commands-Reference.html.4c2d4d5e.js"><link rel="prefetch" href="/immptl/assets/Config-Options.html.e6cfc032.js"><link rel="prefetch" href="/immptl/assets/Datapack-Based-Custom-Portal-Generation.html.6a0903d7.js"><link rel="prefetch" href="/immptl/assets/Dimension-Management.html.36a2477e.js"><link rel="prefetch" href="/immptl/assets/Dimension-Stack.html.608b535e.js"><link rel="prefetch" href="/immptl/assets/Implementation-Details.html.bb3cad8f.js"><link rel="prefetch" href="/immptl/assets/MiniScaled.html.2c087ee0.js"><link rel="prefetch" href="/immptl/assets/Miscellaneous.html.77351173.js"><link rel="prefetch" href="/immptl/assets/Portal-Attributes.html.31b989b8.js"><link rel="prefetch" href="/immptl/assets/Portal-Customization.html.6520bf9e.js"><link rel="prefetch" href="/immptl/assets/Portals.html.180109fb.js"><link rel="prefetch" href="/immptl/assets/index.html.49712fbb.js"><link rel="prefetch" href="/immptl/assets/Spatial-Transformation.html.0971bd81.js"><link rel="prefetch" href="/immptl/assets/404.html.314a0e94.js"><link rel="prefetch" href="/immptl/assets/404.7ce4edf3.js"><link rel="prefetch" href="/immptl/assets/Layout.441f72e9.js"><link rel="prefetch" href="/immptl/assets/photoswipe.esm.185f7ee8.js"><link rel="prefetch" href="/immptl/assets/CollapseTransition.fd9fbcde.js"><link rel="prefetch" href="/immptl/assets/ModDownload.520d6bcb.js"><link rel="prefetch" href="/immptl/assets/SimpleAccordion.ff8c67c5.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/immptl/" class="brand"><img class="logo" src="/immptl/images/immptl.png" alt="Immersive Portals"><!----><span class="site-name hide-in-pad">Immersive Portals</span></a><!----></div><div class="navbar-center"><!----><!----><!----></div><div class="navbar-right"><!----><div class="nav-item"><div class="dropdown-wrapper i18n-dropdown"><button class="dropdown-title" type="button" aria-label="Select language"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html" class="router-link-active router-link-exact-active nav-link active" aria-label="English"><!---->English<!----></a></li><li class="dropdown-item"><a href="/immptl/zh/wiki/Implementation-Details.html" class="nav-link" aria-label="简体中文"><!---->简体中文<!----></a></li></ul></button></div></div><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/immptl/wiki/" class="nav-link sidebar-link sidebar-page" aria-label="Home"><!---->Home<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Portals.html" class="nav-link sidebar-link sidebar-page" aria-label="Portals"><!---->Portals<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Portal-Customization.html" class="nav-link sidebar-link sidebar-page" aria-label="Portal Customization"><!---->Portal Customization<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Spatial-Transformation.html" class="nav-link sidebar-link sidebar-page" aria-label="Spatial Transformation"><!---->Spatial Transformation<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Datapack-Based-Custom-Portal-Generation.html" class="nav-link sidebar-link sidebar-page" aria-label="Datapack-Based Custom Portal Generation"><!---->Datapack-Based Custom Portal Generation<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Dimension-Management.html" class="nav-link sidebar-link sidebar-page" aria-label="Dimension Management"><!---->Dimension Management<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Dimension-Stack.html" class="nav-link sidebar-link sidebar-page" aria-label="Dimension Stack"><!---->Dimension Stack<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Config-Options.html" class="nav-link sidebar-link sidebar-page" aria-label="Config Options"><!---->Config Options<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Commands-Reference.html" class="nav-link sidebar-link sidebar-page" aria-label="Commands Reference"><!---->Commands Reference<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Portal-Attributes.html" class="nav-link sidebar-link sidebar-page" aria-label="Portal Attributes"><!---->Portal Attributes<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Portal-Animation.html" class="nav-link sidebar-link sidebar-page" aria-label="Portal Animation"><!---->Portal Animation<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/MiniScaled.html" class="nav-link sidebar-link sidebar-page" aria-label="MiniScaled"><!---->MiniScaled<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Portal-Gun.html" class="nav-link sidebar-link sidebar-page" aria-label="Portal Gun"><!---->Portal Gun<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/Miscellaneous.html" class="nav-link sidebar-link sidebar-page" aria-label="Miscellaneous"><!---->Miscellaneous<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/immptl/wiki/API-for-Other-Mods.html" class="nav-link sidebar-link sidebar-page" aria-label="API for Other Mods"><!---->API for Other Mods<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Implementation Details</h1><!----><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">On This Page</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#portal-rendering" class="router-link-active router-link-exact-active toc-link level2">Portal Rendering</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#frustum-culling-optimization" class="router-link-active router-link-exact-active toc-link level3">Frustum Culling Optimization</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#front-clipping" class="router-link-active router-link-exact-active toc-link level3">Front Clipping</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#portal-visibility-prediction-optimization-utilizing-temporal-coherence" class="router-link-active router-link-exact-active toc-link level3">Portal Visibility Prediction Optimization Utilizing Temporal Coherence</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#mirror-rendering" class="router-link-active router-link-exact-active toc-link level3">Mirror Rendering</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#other-portal-rendering-algorithms" class="router-link-active router-link-exact-active toc-link level3">Other Portal Rendering Algorithms</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#cross-portal-entity-rendering" class="router-link-active router-link-exact-active toc-link level3">Cross Portal Entity Rendering</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#portal-rendering-merge-optimization" class="router-link-active router-link-exact-active toc-link level3">Portal Rendering Merge Optimization</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#fundamental-changes-to-minecraft" class="router-link-active router-link-exact-active toc-link level2">Fundamental Changes to Minecraft</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#eliminate-the-one-client-world-limitation" class="router-link-active router-link-exact-active toc-link level3">Eliminate the One-Client-World Limitation</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#eliminate-the-near-loading-limitation" class="router-link-active router-link-exact-active toc-link level3">Eliminate the Near-Loading Limitation</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#chunk-visibility-and-entity-visibility-tracking" class="router-link-active router-link-exact-active toc-link level3">Chunk Visibility and Entity Visibility Tracking</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#networking-protocol-changes" class="router-link-active router-link-exact-active toc-link level3">Networking Protocol Changes</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#seamless-teleportation" class="router-link-active router-link-exact-active toc-link level2">Seamless teleportation</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#the-mutual-synchronization-of-player-position" class="router-link-active router-link-exact-active toc-link level3">The Mutual Synchronization of Player Position</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#how-portals-are-stored" class="router-link-active router-link-exact-active toc-link level2">How Portals are Stored</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#other-cross-portal-mechanics" class="router-link-active router-link-exact-active toc-link level2">Other Cross-Portal Mechanics</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#cross-portal-collision" class="router-link-active router-link-exact-active toc-link level3">Cross Portal Collision</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#cross-portal-sound" class="router-link-active router-link-exact-active toc-link level3">Cross Portal Sound</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#cross-portal-block-breaking-and-placement" class="router-link-active router-link-exact-active toc-link level3">Cross Portal Block Breaking and Placement</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#other" class="router-link-active router-link-exact-active toc-link level2">Other</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#handling-rotation-animation-and-gravity-change" class="router-link-active router-link-exact-active toc-link level3">Handling Rotation Animation and Gravity Change</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/immptl/wiki/Implementation-Details.html#portal-frame-matching" class="router-link-active router-link-exact-active toc-link level3">Portal Frame Matching</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="implementation-details" tabindex="-1"><a class="header-anchor" href="#implementation-details" aria-hidden="true">#</a> Implementation Details</h1><h2 id="portal-rendering" tabindex="-1"><a class="header-anchor" href="#portal-rendering" aria-hidden="true">#</a> Portal Rendering</h2><p>There are two ways of rendering portal within the architecture of rasterization:</p><ol><li>Use stencil buffer to limit rendering area and render portals from outer to inner</li><li>Render portal content to another frame buffer first and then draw to the main frame buffer. Render inner portal first.</li></ol><p>This mod mainly adopts the first method. (It also has the &quot;compatibility&quot; rendering mode which uses the second method but does not support portal-in-portal rendering)</p><p>The portal rendering pseudocode:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>renderWorld() {
    prepare
    render solid things
    renderPortals()
    render transparent things
}

renderPortals() {
    if exceeds recursion limit, exit
    for each portal nearby {
        if portal is in frustum {
            render the portal shape with occlusion query
                with stencil func: equal to the portal layer
                with stencil operation: increment by 1
            predict the portal visibility (avoid waiting for occlusion query result)
            if the portal is deemed visible {
                outerStencil = current portal layer
                increment portal layer by 1
                with stencil func: equal to the portal layer, do:
                    clear depth
                    renderWorld() with new position, new dimension, new camera transformation
                        (will do recursion)
                    set depth value by portal shape
                    reset stencil value to outerStencil
                decrement portal layer by 1
            }
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The outmost part of the framebuffer has stencil value 0. Rendering the portal area will increase stencil value by 1. So the stencil value corresponds to the portal layer.</p><p>That&#39;s only the main skeleton of portal rendering. Other details includes:</p><ul><li>Frustum culling optimization</li><li>Visibility prediction optimization</li><li>Enable <code>GL_DEPTH_CLAMP</code> for portal shape rendering. Or if the camera is close to the portal it will do wrong clipping.</li><li>Front clipping by transforming the shader code.</li><li>Because the portal rendering is recursive, all rendering related context should be switched upon rendering, stored on the stack, and then recover after the portal rendering finishes.</li><li>The face culling should be inversed when rendering odd number layers of mirrors (for example, 1, 3, 5 layers of mirrors).</li></ul><h3 id="frustum-culling-optimization" tabindex="-1"><a class="header-anchor" href="#frustum-culling-optimization" aria-hidden="true">#</a> Frustum Culling Optimization</h3><p>This mod use frustum culling optimization in 3 cases:</p><ul><li>To determine whether a portal is invisible before occlusion query rendering</li><li>To cull the invisible sections when rendering portal content (inner frustum culling)</li><li>To cull the things occluded by portal in the outer world (outer frustum culling)</li></ul><p>For example, when rendering this scene</p><p><img src="https://s2.loli.net/2022/03/09/YqCFz4iHWe1JKG2.png" alt=""></p><p>The sections occluded by the portal will be culled. (outer frustum culling)</p><p><img src="https://s2.loli.net/2022/03/09/hNSXDQslVRWAz4n.png" alt=""></p><p>The sections out of portal view will be culled (inner frustum culling)</p><p><img src="https://s2.loli.net/2022/03/09/Pm4sNZqthdiDbRe.png" alt=""></p><p>Without advanced frustum culling: <img src="https://s2.loli.net/2022/03/09/fMXYQVu7ShaqOsD.png" alt=""><img src="https://s2.loli.net/2022/03/09/1bZDdTIcHSUf7B5.png" alt=""></p><h3 id="front-clipping" tabindex="-1"><a class="header-anchor" href="#front-clipping" aria-hidden="true">#</a> Front Clipping</h3><p>When rendering portal content, everything in front of the portal plane will be clipped. The gold block in this image is in nether behind the portal.</p><p><img src="https://s2.loli.net/2022/03/09/nwox68favZd1Ym2.png" alt=""></p><p>If not correctly clipped, the portal will be rendered wrongly:</p><p><img src="https://s2.loli.net/2022/03/09/i3QrLWzctq9kmjh.png" alt=""></p><p>This mod do clipping by transforming the vertex shader and set <code>gl_ClipDistance</code>.</p><p>There is another clipping method using oblique projection. http://www.terathon.com/lengyel/Lengyel-Oblique.pdf Oblique projection does not work well with the things that use pixel depth, and is less straightforward than doing extra clipping.</p><h3 id="portal-visibility-prediction-optimization-utilizing-temporal-coherence" tabindex="-1"><a class="header-anchor" href="#portal-visibility-prediction-optimization-utilizing-temporal-coherence" aria-hidden="true">#</a> Portal Visibility Prediction Optimization Utilizing Temporal Coherence</h3><p>This mod use occlusion query to determine whether a portal is visible. Portal rendering is expensive so we need to only render visible portals.</p><p>However, occlusion query itself has cost. Taking an occlusion query result requires waiting for GPU to finish the previous rendering. Normally CPU and GPU works asynchronously, CPU don&#39;t need to wait for GPU finish the first draw call to submit the second draw call. The synchronization can cost a lot of performance.</p><p>This mod firstly submit the occlusion query and then predict the portal visibility from the old occlusion results, avoid waiting for the occlusion query result in most cases. The prediction is correct in most cases because of temporal coherence: a portal that&#39;s visible will likely to be visible in the next frame, vice versa. In case of successive prediction failure, it will automatically turn to conservative prediction mode. This will improve portal rendering performance in a scene with many portals.</p><h3 id="mirror-rendering" tabindex="-1"><a class="header-anchor" href="#mirror-rendering" aria-hidden="true">#</a> Mirror Rendering</h3><p>After applying one mirror transformation, all counter-clockwise triangles will become clockwise. So the face culling should be inverted. Applying two mirror transformations cancels that. The face culling will be inverted when rendering an odd number of layers of mirrors.</p><h3 id="other-portal-rendering-algorithms" tabindex="-1"><a class="header-anchor" href="#other-portal-rendering-algorithms" aria-hidden="true">#</a> Other Portal Rendering Algorithms</h3><p>As mentioned before, there are 2 ways to do portal rendering in rasterization. This mod uses the first method by default and also provides compatibility render mode that use the second method.</p><p>The first method is to limit the rendering area using stencil buffer. The second method firstly render the portal content into a framebuffer and then draw that framebuffer into the main framebuffer. The reason that this mod does not adopt the second method by default is that <strong>the second method does not allow accurate portal visibility detection by occlusion query</strong>.</p><p>This mod allows deep-nested portal. For example, this mirror room scene:</p><p><img src="https://i.loli.net/2021/11/20/xs9Fb6JDjgWNRlh.png" alt=""></p><p>This mirror room scene involves many portal-in-portal rendering. With the stencil buffer approach we can use occlusion query to accurately determine whether one portal is visible. But with the second method, it&#39;s hard to determine whether a portal-in-portal is visible so it will do a lot more unnecessary rendering.</p><p>The 2 methods above are all under the architecture of rasterization. With ray tracing, portal rendering is much simpler. If the ray hits a portal, just emit a new transformed ray. No clipping is required. And it will be much more efficent in rendering the mirror room scene.</p><h3 id="cross-portal-entity-rendering" tabindex="-1"><a class="header-anchor" href="#cross-portal-entity-rendering" aria-hidden="true">#</a> Cross Portal Entity Rendering</h3><p>If an entity is intersecting with a portal, to render this entity correctly, it will render the entity twice. The entity will be rendered both outside of the portal and inside portal with plane culling. Minecraft uses deferred entity rendering which firstly collects all triangles and then render all of them. This cannot handle the entity rendering that has a special culling plane. So it will first render all collected triangles and then use a separate draw call to render the culled entity.</p><p>For example, this sheep is partly in portal and partly outside of portal</p><p><img src="https://s2.loli.net/2021/12/18/IHhBbXEmfosJ23x.png" alt=""></p><h3 id="portal-rendering-merge-optimization" tabindex="-1"><a class="header-anchor" href="#portal-rendering-merge-optimization" aria-hidden="true">#</a> Portal Rendering Merge Optimization</h3><p>A scale box consists of 6 outer portals and 6 inner portals. Without the portal rendering merge feature, it may require 2 or 3 portal renderings to render a scale box. After merging the portals in a scale box, one scale box can be rendered in one portal rendering.</p><p><img src="https://i.loli.net/2021/09/30/J9bBF82tRu5yIkW.png" alt=""></p><h2 id="fundamental-changes-to-minecraft" tabindex="-1"><a class="header-anchor" href="#fundamental-changes-to-minecraft" aria-hidden="true">#</a> Fundamental Changes to Minecraft</h2><h3 id="eliminate-the-one-client-world-limitation" tabindex="-1"><a class="header-anchor" href="#eliminate-the-one-client-world-limitation" aria-hidden="true">#</a> Eliminate the One-Client-World Limitation</h3><p>Vanilla Minecraft only allows loading one dimension in client at once. This mod eliminates that limitation and changed many code that&#39;s built upon one-client-world assumption. To maintain minimal intrusive and maximum generality, this mod switches the client world context when invoking code associated with remote dimensions.</p><h3 id="eliminate-the-near-loading-limitation" tabindex="-1"><a class="header-anchor" href="#eliminate-the-near-loading-limitation" aria-hidden="true">#</a> Eliminate the Near-Loading Limitation</h3><p>Vanilla Minecraft only allows chunks nearby the player to be loaded. This mod&#39;s portal allows loading very far chunks, so this limitation must be eliminated. Vanilla use a fixed size array to store chunk references and chunk rendering info references. This mod changed them into maps.</p><h3 id="chunk-visibility-and-entity-visibility-tracking" tabindex="-1"><a class="header-anchor" href="#chunk-visibility-and-entity-visibility-tracking" aria-hidden="true">#</a> Chunk Visibility and Entity Visibility Tracking</h3><p>To do world information synchronization, the server must track the chunk visibility and entity visibility for every player. This mod rewrites chunk tracking algorithm. ImmPtl&#39;s chunk tracking algorithm updates periodically and searches for directly and indirectly visible portals. To mitigate the lag spikes, this mod&#39;s chunk tracking algorithm make it gradually loads chunks from near to far. Entity tracking mechanics also gets changed.</p><h3 id="networking-protocol-changes" tabindex="-1"><a class="header-anchor" href="#networking-protocol-changes" aria-hidden="true">#</a> Networking Protocol Changes</h3><p>The server needs to send packets to client to synchronize world informations (blocks, entiteis, etc.). All of these packets does not contain dimension information, so the client cannot discriminate these packets between dimensions.</p><p>To solve that, ImmPtl changed the networking protocol in a minimal intrusive way. It wraps world information packets into a &quot;redirected packet&quot; that contain dimension information, and the client will handle these packets with context switched.</p><h2 id="seamless-teleportation" tabindex="-1"><a class="header-anchor" href="#seamless-teleportation" aria-hidden="true">#</a> Seamless teleportation</h2><p>To make the teleportation seamless, this mod do client side teleportation before every frame&#39;s rendering (not during ticking). Teleportation happens when the camera crosses the portal (not after the player entity crossing the portal).</p><p>Teleportation is iterative. Normally the player at most teleports one time in a frame. But when the player crosses the world wrapping corner the teleportation may happen twice.</p><p><img src="https://s2.loli.net/2021/12/18/agoqwc7NTQ9YizU.png" alt=""></p><h3 id="the-mutual-synchronization-of-player-position" tabindex="-1"><a class="header-anchor" href="#the-mutual-synchronization-of-player-position" aria-hidden="true">#</a> The Mutual Synchronization of Player Position</h3><p>In most cases the server accept client position information. This mod make that position information contain dimension information. And the server must validate the client position to avoid cheating. In some cases, the client accepts position information from the server, for example when a teleportation command executes. The position synchronization is mutual, so it become a little bit complex.</p><h2 id="how-portals-are-stored" tabindex="-1"><a class="header-anchor" href="#how-portals-are-stored" aria-hidden="true">#</a> How Portals are Stored</h2><p>Although nether portals seems be aligned with blocks, this mod does not limit the portals to be aligned with blocks. Portals are entities, not blocks.</p><p>This mod&#39;s portal can be tilted, can be in any shape, can be arbitrarily big (global portals), can be anywhere, can point to any dimension, can point to anywhere, and can have any rotation transformation, scale transformation.</p><p>One portal entity corresponds to a one-way one-faced portal. A normal bi-way, bi-faced nether portal contains 4 portal entities.</p><p>This mod also provide global portal mechanic that allows very big portals. The global portals are stored in per-dimension world data. Dimension stack portals and world wrapping portals are all global portals. Global portals are always loaded, so they can be very big.</p><h2 id="other-cross-portal-mechanics" tabindex="-1"><a class="header-anchor" href="#other-cross-portal-mechanics" aria-hidden="true">#</a> Other Cross-Portal Mechanics</h2><h3 id="cross-portal-collision" tabindex="-1"><a class="header-anchor" href="#cross-portal-collision" aria-hidden="true">#</a> Cross Portal Collision</h3><p>ImmPtl has cross-portal collision. In this scene, the creeper is in overworld (because its eye position is in overworld) but it&#39;s standing on a glass block in nether.</p><p><img src="https://s2.loli.net/2021/12/18/nJrN5oKib1dteVm.png" alt=""></p><p>When an entity is halfway in the portal then its collision will be specially treated.</p><p>The cross portal collision is done as follows: It firstly compute collision outside of the portal while ignoring all collision boxes behind the portal, and then compute collision inside the portal while ignoring all collision boxes behind the destination of the portal, then merge two collision constraints.</p><h3 id="cross-portal-sound" tabindex="-1"><a class="header-anchor" href="#cross-portal-sound" aria-hidden="true">#</a> Cross Portal Sound</h3><p>ImmPtl allows you to hear the sound through portal. To calculate the sound volume, it will find the sound &quot;trajectory&quot;. It firstly finds the nearest point on the portal from the sound source, and then teleport through the portal on that point and then go into the player.</p><h3 id="cross-portal-block-breaking-and-placement" tabindex="-1"><a class="header-anchor" href="#cross-portal-block-breaking-and-placement" aria-hidden="true">#</a> Cross Portal Block Breaking and Placement</h3><p>This mod supports cross-portal block breaking and placement. It can even place blocks across a portal.</p><p>For example, in this dimension stack scene, placing a block upon the top nether will actually place the block to the bottom of overworld.</p><p><img src="https://s2.loli.net/2021/12/18/kPdh7RjqvtTFlY3.png" alt=""></p><h2 id="other" tabindex="-1"><a class="header-anchor" href="#other" aria-hidden="true">#</a> Other</h2><h3 id="handling-rotation-animation-and-gravity-change" tabindex="-1"><a class="header-anchor" href="#handling-rotation-animation-and-gravity-change" aria-hidden="true">#</a> Handling Rotation Animation and Gravity Change</h3><p>If the player cross a portal with rotation transformation, its camera rotation may become tilted which is not a valid camera transformation. To make the teleportation seamless, this mod will do a smooth camera rotation transition. It involves some quaternion math. If gravity changer mod is present, it will take gravity rotations into consideration.</p><h3 id="portal-frame-matching" tabindex="-1"><a class="header-anchor" href="#portal-frame-matching" aria-hidden="true">#</a> Portal Frame Matching</h3><p>This mod supports any-shaped nether portal (with size limit) and also supports adaptive matching for non-square portals. For example, these two L-shaped portals can match, although their scale and rotation are different.</p><p><img src="https://s2.loli.net/2021/12/18/KqDJszQhZGWVmIM.png" alt=""></p></div><!----><footer class="page-meta"><!----><!----><!----></footer><!----><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/immptl/assets/app.0c870a62.js" defer></script>
  </body>
</html>
